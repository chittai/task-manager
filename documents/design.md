# TaskManager 機能要件定義書 (**v1.3**)

## 1. 概要

本ドキュメントは、TaskManager アプリケーションの機能要件を定義するものである。
本アプリケーションは、ユーザーがタスクを管理するための Web アプリケーションであり、Getting Things Done (GTD) の考え方を取り入れ、効率的なタスク処理を支援するとともに、各タスクの対応履歴を記録・確認できることを目指す。

## 2. 機能要件

### 2.1. タスク表示機能

-   FR-001: 登録されているタスクの一覧を表示できること。(変更なし)
-   FR-002: 各タスクについて、以下の情報を表示または保持していること。
    -   タイトル (`title`)
    -   説明 (`description`)
    -   ステータス (`status`: 'inbox','todo', 'in-progress', 'done', 'wait-on' のいずれか。)
    -   優先度 (`priority`: 'low', 'medium', 'high' のいずれか)
    -   期限日 (`dueDate`, オプション)
    -   作成日時 (`createdAt`)
    -   更新日時 (`updatedAt`)
    -   プロジェクトID (`projectId`, オプション、関連するプロジェクトのID)
    -   プロジェクト名 (`projectName`, オプション、表示用)
    -   コメントリスト (`comments`, オプション、Comment オブジェクトの配列)
-   FR-003: アプリケーション起動時やデータ読み込み中に、ローディング状態を示す表示を行うこと。
-   FR-004: タスク一覧をフィルタリング（例: コンテキスト別、プロジェクト別、ステータス別）できること。プロジェクトによる絞り込み機能を含む。
-   FR-005: タスク一覧をソート（例: 期限日順、優先度順、作成日時順）できること。

### 2.2. タスク追加機能 (**GTD: 収集・処理フェーズ**)

-   FR-006: 新しいタスクを追加するためのインターフェース（例: クイック追加バー、モーダルウィンドウ）を提供すること。特に、未整理のアイデアやタスクを素早く「インボックス」に追加できること。
-   FR-007: タスク追加時に、以下の情報を入力できること。
    -   タイトル
    -   （オプション）説明
    -   （オプション）プロジェクト (プロジェクト選択UIより選択)
    -   （オプション）ステータス (デフォルトは 'inbox')
    -   （オプション）優先度
    -   （オプション）期限日
-   FR-008: タスク追加時に、システムは以下を自動的に設定すること。
    -   一意のタスクID (`id`)
    -   作成日時 (`createdAt`)
    -   更新日時 (`updatedAt`)
-   FR-009: 追加されたタスクはタスク一覧（またはインボックス画面）に表示されること。

### 2.3. タスク編集・整理機能 (**GTD: 処理・整理フェーズ**)

-   FR-010: 既存のタスクを選択し、編集するためのインターフェース（モーダルウィンドウ）を提供すること。インボックス内のタスクを処理・整理する際にも使用する。
-   FR-011: タスク編集時に、以下の情報を変更できること。
    -   タイトル
    -   説明
    -   ステータス
    -   優先度
    -   期限日
    -   プロジェクト (プロジェクト選択UIより選択)
-   FR-012: タスク編集時に、システムは更新日時 (`updatedAt`) を自動的に更新すること。
-   FR-013: 編集されたタスクの情報はタスク一覧に反映されること。

### 2.4. タスク削除機能

-   FR-014: 既存のタスクを選択し、削除できること。
-   FR-015: タスク削除前に、確認メッセージを表示すること。
-   FR-016: 削除されたタスクはタスク一覧から除去されること。

### 2.5. タスクステータス変更機能 (**GTD: 実行フェーズ**)

-   FR-017: タスク一覧画面などから、直接タスクのステータス ('todo', 'in-progress', 'done') を変更できること。
-   FR-018: ステータス変更時、システムは更新日時 (`updatedAt`) を自動的に更新すること。

### 2.6. データ永続化機能

-   FR-019: 作成・編集・削除されたタスク情報は、ブラウザを閉じたりリロードしたりしても保持されること (現時点ではブラウザの LocalStorage を使用)。

### 2.7. プロジェクト管理機能

-   FR-020: プロジェクトを作成、編集、削除できること。
-   FR-021: 各プロジェクトに属するタスクの一覧を表示できること。
-   FR-027: プロジェクト一覧ページを提供し、以下の機能を含むこと: (Issue #25)
    -   登録されているすべてのプロジェクトをテーブル形式で一覧表示する（例: プロジェクト名、説明）。
    -   ページヘッダーに「新規プロジェクト作成」ボタンを配置し、クリックするとプロジェクト作成モーダル (`ProjectModal`) を表示する。
    -   各プロジェクトの行に「編集」ボタンと「削除」ボタンを配置する。
        -   「編集」ボタンをクリックすると、該当プロジェクトの情報でプロジェクト編集モーダル (`ProjectModal`) を表示する。
        -   「削除」ボタンをクリックすると、確認ダイアログを表示後、プロジェクトを削除する。

### 2.8. タスク履歴・コメント機能

-   FR-022: 各タスクの詳細画面（またはモーダル内）で、コメントを追加するためのインターフェースを提供すること。
-   FR-023: コメント追加時には、コメント内容と共にシステムが自動的に追加日時（および可能であればユーザー情報）を記録すること。
-   FR-024: 各タスクに関連するコメントの履歴を、時系列（新しいものが上または下）で表示できること。

### 2.9. GTDレビュー支援機能

-   FR-026: 定期的なレビュー（週次レビューなど）をサポートする機能を提供すること（例: 特定のタグが付いたタスクの一覧表示、インボックス内の未処理タスクのリマインドなど）。

### 2.X タスクへのプロジェクト紐付け機能 (Issue #33)

タスクを特定のプロジェクトに関連付けられるようにする。

#### 2.X.1 要件
- タスク作成・編集モーダル (`TaskModal.tsx`) に、プロジェクトを選択するためのドロップダウンリストを追加する。
    - プロジェクトリストは `useProjects` フック（または同等の手段）から取得する。
    - ドロップダウンには既存のプロジェクト名一覧が表示され、ユーザーはそこから選択する。
    - 「プロジェクトなし」も選択肢として含める。
- タスクデータ (`Task` インターフェース) に、選択されたプロジェクトのID (`projectId`) を保存する。
    - `projectId` はオプショナルなプロパティとする。
- (任意) タスクデータ (`Task` インターフェース) には、表示用にプロジェクト名 (`projectName`) も保持する。
    - `projectName` もオプショナルなプロパティとする。
    - `projectName` は、`projectId` に基づいてプロジェクトデータから取得するか、タスク保存時に一緒に保存する。
- プロジェクトが選択されていないタスクも許容する (プロジェクトは任意)。

#### 2.X.2 UI/UX詳細
- `TaskModal.tsx` 内の「タスク詳細」タブに、プロジェクト選択用のドロップダウン (`@cloudscape-design/components` の `Select` コンポーネントを想定) を配置する。
    - ラベル: 「プロジェクト」
    - プレースホルダー: 「プロジェクトを選択」
    - オプション: `useProjects` フックから取得したプロジェクトリスト (`{label: projectName, value: projectId}` の形式) と、「プロジェクトなし」を表すオプション (`{label: "プロジェクトなし", value: ""}` など) を設定する。
    - 選択された値は、タスクオブジェクトの `projectId` に反映される。`projectName` も適宜更新する。

#### 2.X.3 データモデルの変更
- `Task` インターフェース (`src/models/Task.ts`):
    - `projectId?: string;` // 関連するプロジェクトの一意の識別子 (オプション)
    - `projectName?: string;` // (表示用) 関連するプロジェクト名 (オプション)
- `InternalTask` インターフェース (`src/hooks/useTasks.ts`):
    - 同様に `projectId` と `projectName` を追加。

#### 2.X.4 将来的な展望 (Issue #33 の直接的なスコープ外の可能性あり)
- タスク一覧画面 (`TaskList.tsx` など) で、各タスクに関連付けられたプロジェクト名を表示する。
- タスク一覧画面のフィルタリング機能 (FR-004) に「プロジェクト別フィルタリング」を実装する。
- プロジェクト詳細画面 (現時点では未実装) で、そのプロジェクトに関連するタスクの一覧を表示する。

#### 2.X.5 関連コンポーネントへの影響
- `useTasks.ts`:
    - タスクの追加・更新処理において `projectId` および `projectName` を扱えるようにする。
    - `projectName` は `projectId` があればプロジェクトデータから自動的に補完する、あるいはフォームから直接渡された値を使用する。
- `Project.ts` (`src/models/Project.ts`):
    - プロジェクトの型定義。少なくとも `id` と `name` を含むことを想定。
- `useProjects.ts` (仮):
    - プロジェクトの一覧 (`{id: string, name: string}[]` の形式) を取得するためのカスタムフック。
    - 当面は固定のプロジェクトリストを返すか、LocalStorage から読み込む簡易的な実装でも可。将来的にはAPI連携。

## 3. データモデル

本アプリケーションで利用する主要なデータモデルは以下の通りです。

### 3.1. Task

タスク情報を表します。

```typescript
interface Task {
  id: string; // 一意の識別子
  title: string; // タスクのタイトル
  description: string; // タスクの詳細説明
  status: 'inbox' | 'todo' | 'in-progress' | 'done' | 'wait-on'; // タスクのステータス
  priority: 'low' | 'medium' | 'high'; // タスクの優先度
  dueDate?: string; // 期限日 (ISO 8601 format, オプション)
  createdAt: string; // 作成日時 (ISO 8601 format)
  updatedAt: string; // 最終更新日時 (ISO 8601 format)
  projectId?: string; // 関連するプロジェクトの一意の識別子 (オプション)
  projectName?: string; // (表示用) 関連するプロジェクト名 (オプション)
  comments?: Comment[]; // タスクへのコメント (オプション)
}
```

### 3.2. Comment

タスクへのコメント情報を表します。

```typescript
interface Comment {
  id: string; // 一意の識別子
  taskId: string; // 関連タスクのID
  content: string; // コメント内容
  createdAt: string; // 作成日時 (ISO 8601 format)
  userId?: string; // コメント作成者のID (オプション)
}
```

### 3.3. Project

プロジェクト情報を表します。

```typescript
interface Project {
  id: string; // 一意の識別子
  name: string; // プロジェクト名
  description?: string; // プロジェクトの説明 (オプション)
  createdAt: string; // 作成日時 (ISO 8601 format)
  updatedAt: string; // 最終更新日時 (ISO 8601 format)
}
```

## 4. 主要コンポーネント/モジュール構成

### 4.1. モデル (src/models/)

-   `Task.ts`: タスクのデータ構造 (Task インターフェース) を定義します。
-   `Comment.ts`: コメントのデータ構造 (Comment インターフェース) を定義します。
-   `Project.ts`: プロジェクトのデータ構造 (Project インターフェース) を定義します。

### 4.2. フック (src/hooks/)

-   `useTasks.ts` (仮): タスクデータに関する状態管理とCRUD操作（LocalStorage利用）を提供します。(Issue #2 で実装予定)
-   `useProjects.ts`: プロジェクトデータに関する状態管理とCRUD操作（LocalStorage利用）を提供します。

### 4.3. UIコンポーネント (src/components/)

-   `TaskList.tsx` (仮): タスク一覧の表示と操作を行います。(Issue #2 で実装予定)
-   `TaskForm.tsx` (仮): タスクの追加・編集フォームを提供します。Issue #4 により、プロジェクト選択ドロップダウンが追加され、新規タスク作成時のデフォルトステータスが `'inbox'` に設定されるよう変更されました。また、既存タスク編集時にもプロジェクトとステータス（`'inbox'`, `'wait-on'` を含む全定義済みステータス）が選択可能です。
-   `ProjectList.tsx`: プロジェクト一覧の表示と操作（編集・削除ボタンの配置）を行います。Issue #25 で実装予定。
    -   目的: プロジェクト一覧の表示と管理（新規作成、編集、削除）を行う主要コンポーネント。
    -   機能:
        -   `useProjects` フックを利用してプロジェクトデータを取得・表示。
        -   Cloudscape Design System のコンポーネント (例: `Header`, `Table`, `Button`) を使用してUIを構築。
        -   ページ/コンポーネントヘッダー部分に「新規プロジェクト作成」ボタンを配置。クリックすると `ProjectModal` を作成モードで表示。
        -   プロジェクト情報をテーブル形式で表示（例: プロジェクト名、説明、作成日、更新日など）。
        -   テーブルの各行に「編集」ボタンと「削除」ボタンを配置。
            -   「編集」ボタン: 対応するプロジェクトのデータで `ProjectModal` を編集モードで表示。
            -   「削除」ボタン: 確認ダイアログを表示後、`useProjects` フックの `deleteProject` 関数を呼び出してプロジェクトを削除。
    -   UI は Cloudscape Design System のガイドラインに準拠する。
    -   関連Issue: #23 (データフック), #24 (モーダル)
-   `ProjectModal.tsx`: プロジェクトの追加・編集を行うためのモーダルウィンドウを提供します。内部で `ProjectForm` を利用し、Cloudscape Design System のモーダルコンポーネントを使用します。 (Issue #24 で実装予定)
-   `TaskModal.tsx`: タスクの追加・編集、およびコメント表示・追加を行うためのモーダルウィンドウを提供します。
    - Issue #3 および Issue #4 でUI更新を行いました。
    - **Issue #33 対応**: タスク詳細タブ内に、プロジェクトを選択するためのドロップダウンリストが追加されます。プロジェクトリストは `useProjects` (または同等の機能) から取得され、「プロジェクトなし」も選択可能です。詳細は「2.X.2 UI/UX詳細」セクションを参照。

## 5. APIエンドポイント設計

本アプリケーションが利用するAPIエンドポイントの設計です。

### 5.1. タスク操作API

(既存のタスク関連APIがあればここに記述。なければ省略可)

### 5.2. プロジェクト操作API

(既存のプロジェクト関連APIがあればここに記述。なければ省略可)

### 5.3. コメント操作API

タスクに紐づくコメントの操作を行います。

#### 5.3.1. コメント追加

-   **エンドポイント:** `POST /api/tasks/:taskId/comments`
-   **リクエストボディ:**
    ```json
    {
      "text": "新しいコメント内容"
    }
    ```
-   **レスポンス (成功時):** 作成されたコメントオブジェクト
-   **レスポンス (失敗時):** エラー情報

#### 5.3.2. コメント更新

-   **エンドポイント:** `PUT /api/tasks/:taskId/comments/:commentId`
-   **リクエストボディ:**
    ```json
    {
      "text": "更新されたコメント内容"
    }
    ```
-   **レスポンス (成功時):** 更新後のコメントオブジェクト
-   **レスポンス (失敗時):** エラー情報

#### 5.3.3. コメント削除

-   **エンドポイント:** `DELETE /api/tasks/:taskId/comments/:commentId`
-   **レスポンス (成功時):** ステータスコード 204 (No Content) または成功メッセージ
-   **レスポンス (失敗時):** エラー情報

## 6. 技術スタック（想定）

- フロントエンド: React, TypeScript, Cloudscape Design System
- 状態管理: React Context API や Jotai/ Zustand などの軽量ライブラリを検討
- データ永続化: LocalStorage (初期開発フェーズ)、将来的にはバックエンドAPI + データベース

## 7. 今後の課題・拡張案

- ユーザー認証機能
- バックエンドAPIとの連携
- タグ付け機能
- フィルタリング・ソート機能の強化
- 通知機能
